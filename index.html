<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">a
    
    <!-- === META TAGS FOR LINK PREVIEWS (WhatsApp, X, Facebook, etc.) === -->
    <title>360 Fellowship Calendar</title>
    <meta name="description" content="Subscribe to the 360 Calendar.">
    
    <!-- Open Graph tags for richer previews -->
    <meta property="og:title" content="360 Calendar Subscription">
    <meta property="og:description" content="Click to add the 360 Calendar to your device.">
    <!-- === END META TAGS === -->

    <!-- Use Tailwind CSS for simple styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* A simple spinning loader */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script>
        function handleRedirect() {
            // URLs
            const appSubscribeUrl = "webcal://calendar.google.com/calendar/ical/4183b2f66459a6e9f6bdba01b4fb5a8ff16e674626605a3780b4668cbab8422d%40group.calendar.google.com/public/basic.ics";
            const googleCalWebUrl = "https://calendar.google.com/calendar/u/0?cid=NDE4M2IyZjY2NDU5YTZlOWY2YmRiYTAxYjRmYjVhOGZmMTZlNjc0NjI2NjA1YTM3ODBiNDY2OGNiYWI4NDIyZEBncm91cC5jYWxlbmRhci5nb29nbGUuY29t";

            // NEW: Create an Android Intent URL.
            // This tries to open the link in the Google Calendar app package.
            // If the app is not installed, it falls back to the original 'googleCalWebUrl'.
            const androidIntentUrl = "intent://calendar.google.com/calendar/u/0?cid=NDE4M2IyZjY2NDU5YTZlOWY2YmRiYTAxYjRmYjVhOGZmMTZlNjc0NjI2NjA1YTM3ODBiNDY2OGNiYWI4NDIyZEBncm91cC5jYWxlbmRhci5nb29nbGUuY29t#Intent;scheme=https;package=com.google.android.calendar;S.browser_fallback_url=" + encodeURIComponent(googleCalWebUrl) + ";end";

            // Get the user agent string
            const ua = navigator.userAgent;

            // Check for all iOS devices (iPhone, iPad, iPod)
            const isIOS = /iPhone|iPad|iPod/i.test(ua);
            
            // Check for Safari on macOS
            const isMacSafari = /Mac/i.test(ua) && ua.includes('Safari') && !/Chrome|CriOS/i.test(ua);

            // Check for Android
            const isAndroid = /Android/i.test(ua);

            if (isIOS || isMacSafari) {
                // On all iOS browsers or Safari on macOS, show redirect message and go to webcal.
                document.getElementById('redirect-loader').style.display = 'block';
                window.location.href = appSubscribeUrl;
            } else if (isAndroid) {
                // On Android, show the redirect message and attempt to redirect automatically.
                // NOTE: Modern browsers will likely block this without a user click.
                document.getElementById('redirect-loader').style.display = 'block';
                window.location.href = androidIntentUrl;
            } else {
                // For everyone else, show redirect message and go to Google Calendar web.
                document.getElementById('redirect-loader').style.display = 'block';
                window.location.href = googleCalWebUrl;
            }
        }
        
        // Run the function when the DOM is ready
        document.addEventListener('DOMContentLoaded', handleRedirect);
    </script>
</head>
<body class="bg-gray-100 font-sans">
    <div class="flex items-center justify-center min-h-screen p-4">
        <!-- Loader: Visible by default now for all paths -->
        <div id="redirect-loader" class="text-center p-8 bg-white rounded-lg shadow-md" style="display: none;">
            <div class="loader mx-auto mb-4"></div>
            <h1 class="text-2xl font-semibold text-gray-800">Redirecting to your calendar...</h1>
            <p class="text-gray-600 mt-2">Please wait a moment.</p>
        </div>

        <!-- Android Button: This div is no longer used by the script -->
        <div id="android-subscribe" class="text-center p-8 bg-white rounded-lg shadow-md max-w-sm w-full" style="display: none;">
            <h1 class="text-2xl font-semibold text-gray-800 mb-6">Subscribe to Calendar</h1>
            <p class="text-gray-600 mt-2 mb-6">Click the button below to add the calendar to your Google Calendar app.</p>
            <button id="android-button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg shadow-md transition duration-300 ease-in-out w-full">
                Subscribe to the 360 Calendar
            </button>
        </div>
    </div>
</body>
</html>
